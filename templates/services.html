{% extends "base.html" %}

{% block title %}–ù–∞—à–∏ —É—Å–ª—É–≥–∏{% endblock %}

{% block head %}
<style>
    .service-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .service-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
    }
    .service-icon {
        font-size: 3rem;
        color: #0d6efd;
    }
    .review-photo {
        width: 80px;
        height: 80px;
        object-fit: cover;
    }
    .carousel-control-prev-icon, .carousel-control-next-icon {
        background-color: rgba(0, 0, 0, 0.5);
        border-radius: 50%;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1>–ù–∞—à–∏ —É—Å–ª—É–≥–∏</h1>
        <p class="lead text-muted">–ú—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–ø–µ–∫—Ç—Ä —É—Å–ª—É–≥ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤–∞—à–µ–≥–æ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è.</p>
    </div>

    <div class="row g-4">
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üåê</div>
                <h3 class="h5">–£–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</h3>
                <p class="text-muted">–û—Ä–≥–∞–Ω–∏–∑—É–µ–º —Ç—É—Ä—ã –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É, —É—á–∏—Ç—ã–≤–∞—è –≤—Å–µ –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –æ—Ç–¥—ã—Ö–∞.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üö¢</div>
                <h3 class="h5">–ù–∞—à–∏ –∫—Ä—É–∏–∑—ã</h3>
                <p class="text-muted">–û—Ç–∫—Ä–æ–π—Ç–µ –¥–ª—è —Å–µ–±—è –º–∏—Ä —Å –ø–∞–ª—É–±—ã —Ä–æ—Å–∫–æ—à–Ω–æ–≥–æ –ª–∞–π–Ω–µ—Ä–∞. –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">‚úàÔ∏è</div>
                <h3 class="h5">–ê–≤–∏–∞–±–∏–ª–µ—Ç—ã</h3>
                <p class="text-muted">–ü–æ–¥–±–æ—Ä –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤–∏–∞–±–∏–ª–µ—Ç–æ–≤ –ø–æ –ª—É—á—à–∏–º —Ü–µ–Ω–∞–º –≤ –ª—é–±—É—é —Ç–æ—á–∫—É –º–∏—Ä–∞.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üè®</div>
                <h3 class="h5">–ü–æ–¥–±–æ—Ä –æ—Ç–µ–ª–µ–π</h3>
                <p class="text-muted">–®–∏—Ä–æ–∫–∏–π –≤—ã–±–æ—Ä –æ—Ç–µ–ª–µ–π –æ—Ç –±—é–¥–∂–µ—Ç–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–æ —Ä–æ—Å–∫–æ—à–Ω—ã—Ö –∫—É—Ä–æ—Ä—Ç–æ–≤.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üí¨</div>
                <h3 class="h5">–û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞</h3>
                <p class="text-muted">–ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤–∞ –æ–∫–∞–∑–∞—Ç—å –≤–∞–º –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É 24/7.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üë§</div>
                <h3 class="h5">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Ç—É—Ä—ã</h3>
                <p class="text-muted">–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤. –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –º–µ—á—Ç—ã.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üó∫Ô∏è</div>
                <h3 class="h5">–≠–∫—Å–∫—É—Ä—Å–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã</h3>
                <p class="text-muted">–ù–∞—Å—ã—â–µ–Ω–Ω—ã–µ —ç–∫—Å–∫—É—Ä—Å–∏–∏ —Å –æ–ø—ã—Ç–Ω—ã–º–∏ –≥–∏–¥–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–∫—Ä–æ—é—Ç –¥–ª—è –≤–∞—Å –∫—É–ª—å—Ç—É—Ä—É –∏ –∏—Å—Ç–æ—Ä–∏—é.</p>
            </div>
        </div>
        <div class="col-lg-3 col-md-6">
            <div class="card h-100 text-center p-4">
                <div class="service-icon mb-3">üöó</div>
                <h3 class="h5">–¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã –∏ –∞—Ä–µ–Ω–¥–∞</h3>
                <p class="text-muted">–ü—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–∏—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ –∏ –∞—Ä–µ–Ω–¥—ã –∞–≤—Ç–æ –¥–ª—è –≤–∞—à–µ–≥–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏—è.</p>
            </div>
        </div>
    </div>

    <div class="card text-center p-5 my-5 bg-primary text-white">
        <h2>–•–æ—Ç–∏—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —ç—Ç–æ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ?</h2>
        <p class="lead">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É, –∏ –Ω–∞—à –ª—É—á—à–∏–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–±–µ—Ä–µ—Ç –¥–ª—è –≤–∞—Å –∏–¥–µ–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç!</p>
        <button class="btn btn-light btn-lg mt-3" id="openRequestModalButton">–°–≤—è–∑–∞—Ç—å—Å—è —Å –Ω–∞–º–∏!</button>
    </div>

    <div class="reviews-section">
        <h2 class="section-title">–ß—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –Ω–∞—à–∏ –∫–ª–∏–µ–Ω—Ç—ã</h2>
        <div id="reviewCarousel" class="carousel slide card p-4" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="d-flex flex-column align-items-center text-center px-5">
                        <img src="https://www.abcegitim.com/images/urunler/b2-seviye-fransizca-egitimi-sertifika-programi-1727955606.jpg" class="rounded-circle review-photo mb-3" alt="–§–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞">
                        <p class="lead fst-italic">"–≠—Ç–æ –±—ã–ª–æ –ª—É—á—à–µ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏! –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –Ω–∞ –≤—ã—Å—à–µ–º —É—Ä–æ–≤–Ω–µ, –æ—Ç–µ–ª—å –ø—Ä–µ–≤–∑–æ—à–µ–ª –≤—Å–µ –æ–∂–∏–¥–∞–Ω–∏—è. –°–ø–∞—Å–∏–±–æ '–¢—É—Ä–°–µ—Ä–≤–∏—Å' –∑–∞ –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏—è –≤ –ò—Ç–∞–ª–∏–∏!"</p>
                        <h5 class="fw-bold mt-2">–ê–Ω–Ω–∞ –°–º–∏—Ä–Ω–æ–≤–∞</h5>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d-flex flex-column align-items-center text-center px-5">
                        <img src="https://static.tildacdn.com/tild3565-3332-4363-a636-363733633837/y_.jpg" class="rounded-circle review-photo mb-3" alt="–§–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞">
                        <p class="lead fst-italic">"–í–ø–µ—Ä–≤—ã–µ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å –≤ –∫—Ä—É–∏–∑ –∏ –Ω–µ –ø—Ä–æ–≥–∞–¥–∞–ª–∏, –≤—ã–±—Ä–∞–≤ —ç—Ç—É –∫–æ–º–ø–∞–Ω–∏—é. –í—Å–µ –±—ã–ª–æ –ø—Ä–æ–¥—É–º–∞–Ω–æ –¥–æ –º–µ–ª–æ—á–µ–π. –û—Ç–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞—Ç–∏–º—Å—è —Å–Ω–æ–≤–∞!"</p>
                        <h5 class="fw-bold mt-2">–ú–∏—Ö–∞–∏–ª –í–æ—Ä–æ–±—å–µ–≤</h5>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d-flex flex-column align-items-center text-center px-5">
                        <img src="https://cdn.7days.ru/pic/486/834281/241249/90.jpg" class="rounded-circle review-photo mb-3" alt="–§–æ—Ç–æ –∫–ª–∏–µ–Ω—Ç–∞">
                        <p class="lead fst-italic">"–ù–∞–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π —Ç—É—Ä –ø–æ –Ø–ø–æ–Ω–∏–∏. –≠—Ç–æ –±—ã–ª–æ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –£—á–ª–∏ –≤—Å–µ –Ω–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è, –¥–∞–∂–µ —Å–∞–º—ã–µ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ. –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—ã —Å–≤–æ–µ–≥–æ –¥–µ–ª–∞."</p>
                        <h5 class="fw-bold mt-2">–ï–∫–∞—Ç–µ—Ä–∏–Ω–∞ –∏ –î–º–∏—Ç—Ä–∏–π</h5>
                    </div>
                </div>
                 <div class="carousel-item">
                    <div class="d-flex flex-column align-items-center text-center px-5">
                        <img src="https://i.pravatar.cc/150?img=12" class="rounded-circle review-photo mb-3" alt="...">
                        <p class="lead fst-italic">"–ë—ã—Å—Ç—Ä–æ –ø–æ–¥–æ–±—Ä–∞–ª–∏ –±–∏–ª–µ—Ç—ã –∏ –æ—Ç–µ–ª—å –¥–ª—è –¥–µ–ª–æ–≤–æ–π –ø–æ–µ–∑–¥–∫–∏ –≤ –°—Ç–∞–º–±—É–ª. –í—Å–µ —á–µ—Ç–∫–æ, –±–µ–∑ –Ω–∞–∫–ª–∞–¥–æ–∫ –∏ –ø–æ –æ—Ç–ª–∏—á–Ω–æ–π —Ü–µ–Ω–µ. –†–µ–∫–æ–º–µ–Ω–¥—É—é."</p>
                        <h5 class="fw-bold mt-2">–ò–≥–æ—Ä—å –ë–µ–ª–æ–≤</h5>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#reviewCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#reviewCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∑–∞—è–≤–∫–∏ -->
<div class="modal fade" id="request-modal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="request-modal-title">–ó–∞–ø—Ä–æ—Å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>–û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –∏ –Ω–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!</p>
                <div class="mb-3">
                    <label for="request-name" class="form-label">–í–∞—à–µ –§–ò–û</label>
                    <input type="text" class="form-control" id="request-name">
                </div>
                <div class="mb-3">
                    <label for="request-phone" class="form-label">–í–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
                    <input type="tel" class="form-control" id="request-phone">
                </div>
                <div id="request-error" class="text-danger"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" id="submitRequestButton">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- –õ–æ–≥–∏–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ ---
    const token = getCookie('token');
    const payload = parseJwt(token);
    const requestModalElement = document.getElementById('request-modal');
    const requestModal = new bootstrap.Modal(requestModalElement);
    const openRequestModalButton = document.getElementById('openRequestModalButton');
    const submitRequestButton = document.getElementById('submitRequestButton');
    let currentRequestSource = '';

    const validators = {
        fullName: (val) => /^[–∞-—è–ê-–Ø—ë–Å\s-]{5,}$/.test(val) && val.split(' ').length >= 2,
        phone: (val) => /^(\+7|8)\d{10}$/.test(val)
    };
    const errorMessages = {
        fullName: '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –§–ò–û –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ (–º–∏–Ω–∏–º—É–º 2 —Å–ª–æ–≤–∞).',
        phone: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (–ø—Ä–∏–º–µ—Ä: +79123456789).'
    };

    socket.on('contact_request_response', (data) => {
        const errorDiv = document.getElementById('request-error');
        if(data.success) {
            showToast(data.message, 'success');
            requestModal.hide();
            errorDiv.innerText = '';
        } else {
            errorDiv.innerText = data.message;
        }
    });

    openRequestModalButton.onclick = () => {
        currentRequestSource = '–û–±—â–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –£—Å–ª—É–≥';
        document.getElementById('request-modal-title').innerText = `–ó–∞–ø—Ä–æ—Å –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é`;
        const nameInput = document.getElementById('request-name');
        const phoneInput = document.getElementById('request-phone');

        if (payload && payload.role === 'client') {
            socket.emit('get_my_profile', {token: token});
            socket.once('my_profile_data', (data) => {
                if (data.profile) {
                    nameInput.value = data.profile.full_name || '';
                    phoneInput.value = data.profile.contact_phone || '';
                }
            });
        } else {
            nameInput.value = '';
            phoneInput.value = '';
        }
        requestModal.show();
    };

    submitRequestButton.onclick = () => {
        const nameInput = document.getElementById('request-name');
        const phoneInput = document.getElementById('request-phone');
        const errorDiv = document.getElementById('request-error');
        errorDiv.innerText = '';

        if (!validators.fullName(nameInput.value)) { errorDiv.innerText = errorMessages.fullName; return; }
        if (!validators.phone(phoneInput.value)) { errorDiv.innerText = errorMessages.phone; return; }

        socket.emit('submit_contact_request', {
            fullName: nameInput.value,
            phone: phoneInput.value,
            source: currentRequestSource
        });
    };
});
</script>
{% endblock %}